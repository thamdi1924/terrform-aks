# Azure DevOps pipeline for Azure deployment

#variables:
#- group: terraform-tuesdays

trigger:
  branches:
    include:
    - main
  # paths:
  #  include:
  # - 2021-05-11-ADO/vnet
pool:
  vmImage: ubuntu-latest

stages:
- stage: Validate_stage
  displayName: Validate
  jobs:
  - job: validate_job

    steps:
    - task: TerraformInstaller@0
      displayName: Install Terraform
      inputs:
        terraformVersion: 'latest'

  # Init
    - task: TerraformTaskV3@3
      displayName: Initiate Terraform
      inputs:
        provider: 'azurerm'
        command: 'init'
        backendServiceArm: 'sc-terraform2'
        backendAzureRmResourceGroupName: 'rg-terraform'
        backendAzureRmStorageAccountName: 'stterraform2022'
        backendAzureRmContainerName: 'stcontainerterraform'
        backendAzureRmKey: 'terraform.tfstate'

         # Validate
    - task: TerraformTaskV3@3
      displayName: Validate Config
      inputs:
        command: 'validate'

    - task: TerraformTaskV3@3
      displayName: execute plan
      inputs:
        provider: 'azurerm'
        environmentServiceNameAzureRM: 'sc-terraform2'
        command: 'plan'


      



